<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Deadlock Resilient Mutex: libwfg.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Deadlock Resilient Mutex
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('libwfg_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">libwfg.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &quot;libwfg.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="queue_8h_source.html">queue.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad53ee85279669e10462708e5a3df11e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#ad53ee85279669e10462708e5a3df11e9">wfg_init</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg)</td></tr>
<tr class="memdesc:ad53ee85279669e10462708e5a3df11e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the wait-for graph data structure.  <a href="#ad53ee85279669e10462708e5a3df11e9"></a><br/></td></tr>
<tr class="memitem:aa90fa5251ec30a38245a1919883be67e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa90fa5251ec30a38245a1919883be67e"></a>
<a class="el" href="structedge__t.html">edge_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>fetch_thread_wait</b> (<a class="el" href="structqueue__t.html">queue_t</a> *q, pthread_t t_id)</td></tr>
<tr class="memitem:ad8b54cac48a076a35cb10cdecc167a3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#ad8b54cac48a076a35cb10cdecc167a3f">wfg_add_wait_edge</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg, pthread_t t_id, unsigned int r_id)</td></tr>
<tr class="memdesc:ad8b54cac48a076a35cb10cdecc167a3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a "wait" edge to the wait-for graph.  <a href="#ad8b54cac48a076a35cb10cdecc167a3f"></a><br/></td></tr>
<tr class="memitem:a19e5daa089bd4890111ca2e8f2354d2c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a19e5daa089bd4890111ca2e8f2354d2c"></a>
<a class="el" href="structedge__t.html">edge_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>fetch_resource_hold</b> (<a class="el" href="structqueue__t.html">queue_t</a> *q, unsigned int r_id)</td></tr>
<tr class="memitem:a81bc7c42c814f9cf691c2cf2e67f6c2c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#a81bc7c42c814f9cf691c2cf2e67f6c2c">wfg_add_hold_edge</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg, pthread_t t_id, unsigned int r_id)</td></tr>
<tr class="memdesc:a81bc7c42c814f9cf691c2cf2e67f6c2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Replaces a "wait" edge with a "hold" edge on a wait-for graph.  <a href="#a81bc7c42c814f9cf691c2cf2e67f6c2c"></a><br/></td></tr>
<tr class="memitem:a6277c30688a26ae62005629932e45012"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#a6277c30688a26ae62005629932e45012">wfg_remove_edge</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg, pthread_t t_id, unsigned int r_id)</td></tr>
<tr class="memdesc:a6277c30688a26ae62005629932e45012"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes an edge on the wait-for graph.  <a href="#a6277c30688a26ae62005629932e45012"></a><br/></td></tr>
<tr class="memitem:a3957132faa50f1643ca36c9f446f6f34"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#a3957132faa50f1643ca36c9f446f6f34">wfg_get_cycle</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg, pthread_t **cycle)</td></tr>
<tr class="memdesc:a3957132faa50f1643ca36c9f446f6f34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the numebr of threads and the identifiers of each thread that is contained in a cycle on the wait-for graph.  <a href="#a3957132faa50f1643ca36c9f446f6f34"></a><br/></td></tr>
<tr class="memitem:a474005cb645982bbd2f647f038cc8c5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#a474005cb645982bbd2f647f038cc8c5f">wfg_print_graph</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg)</td></tr>
<tr class="memdesc:a474005cb645982bbd2f647f038cc8c5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints all wait-for relations between threads in the wait-for graph.  <a href="#a474005cb645982bbd2f647f038cc8c5f"></a><br/></td></tr>
<tr class="memitem:a2d5aac90a7eeaaf6874ba0bc2138f945"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libwfg_8c.html#a2d5aac90a7eeaaf6874ba0bc2138f945">wfg_destroy</a> (<a class="el" href="structwfg__t.html">wfg_t</a> *wfg)</td></tr>
<tr class="memdesc:a2d5aac90a7eeaaf6874ba0bc2138f945"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroys the wait-for graph data structure.  <a href="#a2d5aac90a7eeaaf6874ba0bc2138f945"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"></div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a81bc7c42c814f9cf691c2cf2e67f6c2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wfg_add_hold_edge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t&#160;</td>
          <td class="paramname"><em>t_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>r_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Replaces a "wait" edge with a "hold" edge on a wait-for graph. </p>
<p>This function replaces an edge directed from a thread to a resource (a "wait" edge) with an edge directed from the resource to the thread (a "hold" edge). If the thread does not contain a directed edge to the resource when this function is called, this function should fail. This function should also fail if the resource is already "held" by another thread.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
    <tr><td class="paramname">t_id</td><td>A unique identifier to a thread. A caller to this function may want to use the thread ID used by the system, by using the pthread_self() function. </td></tr>
    <tr><td class="paramname">r_id</td><td>A unique identifier to a resource.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>If successful, this function should return 0. Otherwise, this function returns a non-zero value. </dd></dl>

</div>
</div>
<a class="anchor" id="ad8b54cac48a076a35cb10cdecc167a3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wfg_add_wait_edge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t&#160;</td>
          <td class="paramname"><em>t_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>r_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a "wait" edge to the wait-for graph. </p>
<p>This function adds a directed edge from a thread to a resource in the wait-for graph. If the thread is already waiting on any resource (including the resource) requested, this function should fail.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
    <tr><td class="paramname">t_id</td><td>A unique identifier to a thread. A caller to this function may want to use the thread ID used by the system, by using the pthread_self() function. </td></tr>
    <tr><td class="paramname">r_id</td><td>A unique identifier to a resource.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>If successful, this function should return 0. Otherwise, this function returns a non-zero value. </dd></dl>

</div>
</div>
<a class="anchor" id="a2d5aac90a7eeaaf6874ba0bc2138f945"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfg_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroys the wait-for graph data structure. </p>
<p>This function must always be called last, after all other libwfg functions.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3957132faa50f1643ca36c9f446f6f34"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wfg_get_cycle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t **&#160;</td>
          <td class="paramname"><em>cycle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the numebr of threads and the identifiers of each thread that is contained in a cycle on the wait-for graph. </p>
<p>If the wait-for graph contains a cycle, this function allocates an array of unsigned ints equal to the size of the cycle, populates the array with the thread identifiers of the threads in the cycle, modifies the value of <code>cycle</code> to point to this newly created array, and returns the length of the array.</p>
<p>For example, if a cycle exists such that: <code>t(id=1) =&gt; r(id=100) =&gt; t(id=2) =&gt; r(id=101) =&gt; t(id=1) (cycle)</code> ...the array will be of length two and contain the elements: [1, 2].</p>
<p>This function only returns a single cycle and may return the same cycle each time the function is called until the cycle has been removed. This function can return ANY cycle, but it must contain only threads in the cycle itself.</p>
<p>It is up to the user of this library to free the memory allocated by this function.</p>
<p>If no cycle exists, this function must not allocate any memory and will return 0.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
    <tr><td class="paramname">cycle</td><td>A pointer to an (unsigned int *), used by the function to return the cycle in the wait-for graph if a cycle exists.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>The number of threads in the identified cycle in the wait-for graph, or 0 if no cycle exists. </dd></dl>

</div>
</div>
<a class="anchor" id="ad53ee85279669e10462708e5a3df11e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfg_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the wait-for graph data structure. </p>
<p>This function must always be called first, before any other libwfg functions.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a474005cb645982bbd2f647f038cc8c5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wfg_print_graph </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints all wait-for relations between threads in the wait-for graph. </p>
<p>In a wait-for graph, a thread is "waiting for" another thread if a thread has a "wait" edge on a resource that is being "held" by another process. This function prints all of the edges to stdout in a comma- seperated list in the following format: <code>[thread]=&gt;[thread], [thread]=&gt;[thread]</code></p>
<p>If t(id=1) and t(id=2) are both waiting for r(id=100), but (r=100) is held by t(id=3), the printout should be: <code>1=&gt;3, 2=&gt;3</code></p>
<p>When printing out the wait-for relations:</p>
<ul>
<li>this function may list the relations in any order,</li>
<li>all relations must be printed on one line,</li>
<li>all relations must be seperated by comma and a space (see above),</li>
<li>a newline should be placed at the end of the list, and</li>
<li>you may have an extra trailing ", " if it's easier for your program (not required, but should save you a bit of coding).</li>
</ul>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a6277c30688a26ae62005629932e45012"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wfg_remove_edge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwfg__t.html">wfg_t</a> *&#160;</td>
          <td class="paramname"><em>wfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pthread_t&#160;</td>
          <td class="paramname"><em>t_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>r_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes an edge on the wait-for graph. </p>
<p>If any edge exists between the thread and resource, this function removes that edge (either a "hold" edge or a "wait" edge).</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">wfg</td><td>The wait-for graph data structure. </td></tr>
    <tr><td class="paramname">t_id</td><td>A unique identifier to a thread. A caller to this function may want to use the thread ID used by the system, by using the pthread_self() function. </td></tr>
    <tr><td class="paramname">r_id</td><td>A unique identifier to a resource.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd><ul>
<li>0, if an edge was removed</li>
<li>non-zero, if no edge was removed </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="libwfg_8c.html">libwfg.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.1 </li>
  </ul>
</div>
</body>
</html>
