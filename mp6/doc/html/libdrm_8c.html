<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Deadlock Resilient Mutex: libdrm.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Deadlock Resilient Mutex
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('libdrm_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">libdrm.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &quot;libdrm.h&quot;</code><br/>
<code>#include &quot;libwfg.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="queue_8h_source.html">queue.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1bf9b42f6ea2759481b71abbc42aa9c6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1bf9b42f6ea2759481b71abbc42aa9c6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EXITERROR</b>(e)&#160;&#160;&#160;_exit_error_(__FUNCTION__,__LINE__,e)</td></tr>
<tr class="memitem:ad72dbcf6d0153db1b8d8a58001feed83"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad72dbcf6d0153db1b8d8a58001feed83"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEBUG</b></td></tr>
<tr class="memitem:a31cbc593db4fbcc518a5b0a4aff903ac"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a31cbc593db4fbcc518a5b0a4aff903ac"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DDEBUG</b></td></tr>
<tr class="memitem:afde8558db9d410d0f8b1930a5a369bdf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afde8558db9d410d0f8b1930a5a369bdf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>D</b>(x)&#160;&#160;&#160;x</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab29ab883661393c307022aa3cfbade11"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab29ab883661393c307022aa3cfbade11"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>_exit_error_</b> (const char *func, unsigned int line, char *error)</td></tr>
<tr class="memitem:a12e391be8dcbfc5e5ea08d15ab4f46c1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a12e391be8dcbfc5e5ea08d15ab4f46c1"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>add_wait_edge</b> (unsigned int r_id)</td></tr>
<tr class="memitem:a12f7e685d463ad8c51fd44ac6ce039db"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a12f7e685d463ad8c51fd44ac6ce039db"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>add_hold_edge</b> (unsigned int r_id)</td></tr>
<tr class="memitem:a7609f31a0900c9f1770949f1ced98dc2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7609f31a0900c9f1770949f1ced98dc2"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>remove_edge</b> (unsigned int r_id)</td></tr>
<tr class="memitem:aa79f3b0865189c381c0cca840fe53671"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa79f3b0865189c381c0cca840fe53671"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>print_graph</b> ()</td></tr>
<tr class="memitem:a978a234f03e83872907809c2ecfaa788"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a978a234f03e83872907809c2ecfaa788"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>exist_cycle</b> ()</td></tr>
<tr class="memitem:a36ce264af0fc5cd2f8b68c7cb9c4c1b4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a36ce264af0fc5cd2f8b68c7cb9c4c1b4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>get_cycle</b> (pthread_t **cycle)</td></tr>
<tr class="memitem:a81d640b6784689f8fd920c141f020ae9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a81d640b6784689f8fd920c141f020ae9"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><b>getId</b> ()</td></tr>
<tr class="memitem:a19c732a8de525a3f67fc33d04c8830ef"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a19c732a8de525a3f67fc33d04c8830ef"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>resetID</b> ()</td></tr>
<tr class="memitem:a7c07e5a862d685a451b5ab4490681ab0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7c07e5a862d685a451b5ab4490681ab0"></a>
void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#a7c07e5a862d685a451b5ab4490681ab0">cycle_detect_thread</a> (void *arg)</td></tr>
<tr class="memdesc:a7c07e5a862d685a451b5ab4490681ab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">the thread function for detection cycles <br/></td></tr>
<tr class="memitem:a2ce50cf88b5148bec230cea7b32f8cb4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#a2ce50cf88b5148bec230cea7b32f8cb4">drm_setmode</a> (enum drmmode_t mode)</td></tr>
<tr class="memdesc:a2ce50cf88b5148bec230cea7b32f8cb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the mode of the deadlock resilient mutex.  <a href="#a2ce50cf88b5148bec230cea7b32f8cb4"></a><br/></td></tr>
<tr class="memitem:a96350687e8fe0e93912d41aa346733a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#a96350687e8fe0e93912d41aa346733a7">drm_cleanup</a> ()</td></tr>
<tr class="memdesc:a96350687e8fe0e93912d41aa346733a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees all memory used by libdrm.  <a href="#a96350687e8fe0e93912d41aa346733a7"></a><br/></td></tr>
<tr class="memitem:aa86a5c3d6be5b2ee718ff6b5c7ec0c19"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#aa86a5c3d6be5b2ee718ff6b5c7ec0c19">drm_init</a> (<a class="el" href="structdrm__t.html">drm_t</a> *mutex)</td></tr>
<tr class="memdesc:aa86a5c3d6be5b2ee718ff6b5c7ec0c19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a deadlock resilient mutex.  <a href="#aa86a5c3d6be5b2ee718ff6b5c7ec0c19"></a><br/></td></tr>
<tr class="memitem:a490045e34888f2bfdf5e5162b0195738"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#a490045e34888f2bfdf5e5162b0195738">drm_lock</a> (<a class="el" href="structdrm__t.html">drm_t</a> *mutex)</td></tr>
<tr class="memdesc:a490045e34888f2bfdf5e5162b0195738"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock a deadlock resilient mutex.  <a href="#a490045e34888f2bfdf5e5162b0195738"></a><br/></td></tr>
<tr class="memitem:a0bef9ae9ddea9d4bcc8591e44962c969"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#a0bef9ae9ddea9d4bcc8591e44962c969">drm_unlock</a> (<a class="el" href="structdrm__t.html">drm_t</a> *mutex)</td></tr>
<tr class="memdesc:a0bef9ae9ddea9d4bcc8591e44962c969"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock a deadlock resilient mutex.  <a href="#a0bef9ae9ddea9d4bcc8591e44962c969"></a><br/></td></tr>
<tr class="memitem:ab67642df60ada7fed0b4e5a56885dd44"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="libdrm_8c.html#ab67642df60ada7fed0b4e5a56885dd44">drm_destroy</a> (<a class="el" href="structdrm__t.html">drm_t</a> *mutex)</td></tr>
<tr class="memdesc:ab67642df60ada7fed0b4e5a56885dd44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy a deadlock resilient mutex.  <a href="#ab67642df60ada7fed0b4e5a56885dd44"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa2b4405b9015131527bf08b2258284c1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa2b4405b9015131527bf08b2258284c1"></a>
enum drmmode_t&#160;</td><td class="memItemRight" valign="bottom"><b>runmode</b></td></tr>
<tr class="memitem:a0dd14fb57e3d3cc6b6fc5633c6ce65d5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0dd14fb57e3d3cc6b6fc5633c6ce65d5"></a>
unsigned int&#160;</td><td class="memItemRight" valign="bottom"><b>ID</b> = 0</td></tr>
<tr class="memitem:acdf17cbf23b0507db8d316b83f3bd023"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acdf17cbf23b0507db8d316b83f3bd023"></a>
<a class="el" href="structqueue__t.html">queue_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>q_mutex</b></td></tr>
<tr class="memitem:ae1b93ed3835f8235ad494d149538eace"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae1b93ed3835f8235ad494d149538eace"></a>
<a class="el" href="structwfg__t.html">wfg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>wfg_o</b></td></tr>
<tr class="memitem:a6270f9280c22df7d6cc4f69f30937d06"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6270f9280c22df7d6cc4f69f30937d06"></a>
pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><b>mutex_wfg</b></td></tr>
<tr class="memitem:a20a1d7a1a6311f26ccea3aef3225c6b5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a20a1d7a1a6311f26ccea3aef3225c6b5"></a>
pthread_t&#160;</td><td class="memItemRight" valign="bottom"><b>o_thread</b></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"></div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a96350687e8fe0e93912d41aa346733a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drm_cleanup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees all memory used by libdrm. </p>
<p>This function will be called last, after all mutexes have been destroyed. </p>

</div>
</div>
<a class="anchor" id="ab67642df60ada7fed0b4e5a56885dd44"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drm_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdrm__t.html">drm_t</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroy a deadlock resilient mutex. </p>
<p>This function should function similarly to pthread_mutex_destory().</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>A deadlock resilient mutex. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa86a5c3d6be5b2ee718ff6b5c7ec0c19"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drm_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdrm__t.html">drm_t</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a deadlock resilient mutex. </p>
<p>This function should function similarly to pthread_mutex_init().</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>A deadlock resilient mutex. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a490045e34888f2bfdf5e5162b0195738"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int drm_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdrm__t.html">drm_t</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Lock a deadlock resilient mutex. </p>
<p>This function should function similarly to pthread_mutex_lock(), except it must also follow the specific rules for the deadlock resilient mode that has been set by the user.</p>
<p>When you call the underlying pthread_mutex_lock(), make sure to check its return value. If pthread_mutex_lock() fails, the lock was not acquired and you must return a failure from your <a class="el" href="libdrm_8c.html#a490045e34888f2bfdf5e5162b0195738" title="Lock a deadlock resilient mutex.">drm_lock()</a> function (don't simply retry again and again).</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>A deadlock resilient mutex.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>When the lock is successfully acquired, this function returns zero (0). Otherwise, returns non-zero. </dd></dl>

</div>
</div>
<a class="anchor" id="a2ce50cf88b5148bec230cea7b32f8cb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drm_setmode </td>
          <td>(</td>
          <td class="paramtype">enum drmmode_t&#160;</td>
          <td class="paramname"><em>mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the mode of the deadlock resilient mutex. </p>
<p>This function will only be called once, before any of the other libdrm functions. This functions sets the global state of all drm mutexes.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">mode</td><td>One of the following deadlock resilient modes:<ul>
<li>NO_DEADLOCK_CHECKING</li>
<li>DEADLOCK_PREVENTION</li>
<li>DEADLOCK_DETECTION</li>
<li>DEADLOCK_AVOIDANCE </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0bef9ae9ddea9d4bcc8591e44962c969"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int drm_unlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdrm__t.html">drm_t</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock a deadlock resilient mutex. </p>
<p>This function should function similarly to pthread_mutex_unlock().</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>A deadlock resilient mutex.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>When the lock is successfully unlocked, this function returns zero (0). Otherwise, returns non-zero. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="libdrm_8c.html">libdrm.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.1 </li>
  </ul>
</div>
</body>
</html>
